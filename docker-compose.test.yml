services:
  xyops-test-auto:
    build:
      context: .
      dockerfile: Dockerfile
    working_dir: /opt/xyops
    command: ["npm", "test"]
    environment:
      NODE_ENV: test
    volumes:
      - .:/opt/xyops
    profiles: ["auto"]

  xyops-test-manual:
    build:
      context: .
      dockerfile: Dockerfile
    working_dir: /opt/xyops
    command: ["bash", "-lc", "node bin/build.js dev && bin/debug.sh"]
    environment:
      XYOPS_foreground: "true"
      XYOPS_echo: "xyOps Transaction Error API Action Job Workflow Alert"
      XYOPS_automation_manager__enabled: "true"
      XYOPS_automation_manager__mode: "advisory"
    volumes:
      - .:/opt/xyops
    ports:
      - "5522:5522"
      - "5523:5523"
    profiles: ["manual"]

  langflow:
    build:
      context: .
      dockerfile: Dockerfile.langflow
    working_dir: /opt/xyops
    command: ["langflow", "run", "--host", "0.0.0.0", "--port", "7860"]
    environment:
      LANGFLOW_DATABASE_URL: "sqlite:////data/langflow/langflow.db"
      LANGFLOW_CONFIG_DIR: "/data/langflow"
      LANGFLOW_AUTO_LOGIN: "false"
    volumes:
      - .:/opt/xyops
      - ./.langflow:/data/langflow
    ports:
      - "7860:7860"
    profiles: ["langflow"]
